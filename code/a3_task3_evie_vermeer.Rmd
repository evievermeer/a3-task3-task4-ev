---
title: "Asssignment 3, Task 3"
author: "Evie Vermeer"
date: "10/24/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
options(digits=3)
library(here)
library(tidyverse)
library(ggplot2)
library(janitor)
library(kableExtra)
library(lubridate)
```

```{r}
# Read in data
urchins <- read_csv(here("data","urchins.csv")) %>% clean_names()
```

### Section 1: Size comparisons, purple and red urchins
```{r}
# Data vizualization
ggplot(data = urchins, aes(x=size,fill=common_name)) +
  geom_histogram(bins = 10, position = "identity")+
  facet_wrap(~common_name)+
  labs(x = "Urchin Diameter (mm)",
       y= "Number of Urchins",
       title = "Size Distribution Comparisons, Purple and Red Urchins",
       fill ="Urchin Type") +
  scale_fill_manual(values = c("Purple Urchin"="blueviolet","Red Urchin"="firebrick3"))

### facet wrap by common name

```

```{r}
#Descriptive statistics table
urchins_stats <- urchins %>% 
  group_by(common_name) %>% 
  summarize(mean_size = mean(size, na.rm = TRUE),
            sd_size = sd(size, na.rm = TRUE),
            sample_size = n())

urchins_stats %>% 
  kable(col.names = c("Species",
                      "Mean (mm)",
                      "Standard Deviation (mm)",
                      "Sample Size (n)"),
                    caption = "Descriptive Statistics of Urchin Diameters by Species",
                    digits = 3) %>% 
  kable_styling(full_width = FALSE)
```

##### These data show that purple urchins are generally smaller in diameter than red urchins. Specifically, the average diameter of a purple urchin is 34% less than the average diameter of a red urchin (4.47 and 6.78 mm, respectively). The histogram above shows the the most common size of a purple urchin is less than the most common size of a red urchin. 

### Section 2: Purple Urchin Counts by site and year

```{r}
purple_urchins <- urchins %>% 
  filter(common_name=="Purple Urchin") %>% 
  mutate(date_new = mdy(date)) %>% 
  mutate(year = year(date_new)) %>% 
  mutate(full_site = case_when(
          site %in% c("NAPL") ~ "Naples Reef",
          site %in% c("AQUE") ~ "Arroyo Quemado Reef",
          site %in% c("CARP") ~ "Carpinteria Reef",
          site %in% c("MOHK") ~ "Mohawk Reef",
          site %in% c("IVEE") ~ "Isla Vista Reef"))

```

```{r}
purple_urchins_stats <- purple_urchins %>% 
  group_by(full_site,year) %>% 
  count(common_name) %>% 
  na.omit()
```

```{r}
ggplot(data = purple_urchins_stats, aes(x=year, y=n,fill=full_site,color=full_site))+
  geom_line(stat = "identity")+
  theme_bw()+
  labs(x="Year",
       y="Number of Purple Urchins",
       title="Number of Purple Urchins at Each Site by Year",
       fill="Reef")+
  scale_x_continuous(breaks = seq(2008,2020,2))

### Need to update your legend title 
### can also use scale_x_discrete(limit = c(2008-2020))
```
## 

##### The data shown lead me to a few preliminary observations. At first glance, it would seem to show that purple sea urchins are declining at these sites year over year. However, we would need to aggregate the number of urchins at each site for this timeframe and determine some summary statistics such as the mean and the data spread, and then compare these data and their progressions in that context. A regression of these trends would be helpful as well. One last thing to note is that data collection may have been unreliable (considering the lack of observations for all sites - particularly 2004 & 2007). Thus this may not be the most representative sample. 


